<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LEONEL - NIVEL 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { gold: '#D4AF37', dark: '#050505', panel: '#151515' },
                    fontFamily: { sans: ['Inter', 'sans-serif'], heading: ['Oswald', 'sans-serif'] },
                    animation: { 'fade-in': 'fadeIn 0.8s ease-out forwards', 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(20px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        .glass-panel { background: rgba(30, 30, 30, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(212, 175, 55, 0.15); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); }
        .gold-text { background: linear-gradient(to right, #D4AF37, #F1D780, #D4AF37); -webkit-background-clip: text; color: transparent; background-size: 200% auto; animation: shine 3s linear infinite; }
        @keyframes shine { to { background-position: 200% center; } }
        
        /* Lock Screen */
        #lock-screen { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; }
        .lock-input { background: transparent; border-bottom: 2px solid #333; color: #D4AF37; font-family: 'Oswald'; font-size: 2rem; text-align: center; width: 80%; outline: none; letter-spacing: 2px; text-transform: uppercase; }
        
        /* Level Modal Overlay */
        #level-expired { position: fixed; inset: 0; z-index: 9950; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }

        .card-exercise { background: linear-gradient(145deg, #151515, #0a0a0a); border: 1px solid #222; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .card-exercise:active { transform: scale(0.98); }

        .day-check { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .day-check.completed { background: linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%); color: black; border: none; box-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }
        .day-check.today-border { border-color: #D4AF37; box-shadow: 0 0 10px rgba(212, 175, 55, 0.5) inset; }
        .day-check.future { opacity: 0.3; pointer-events: none; }

        .nav-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 50; background: rgba(20,20,20,0.9); backdrop-filter: blur(10px); padding: 8px; border-radius: 9999px; border: 1px solid rgba(255,255,255,0.1); display: flex; gap: 4px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .dock-item { padding: 10px 20px; border-radius: 9999px; color: #666; font-size: 10px; text-transform: uppercase; font-weight: bold; transition: all 0.3s; display: flex; align-items: center; gap: 6px; }
        .dock-item.active { background: #D4AF37; color: black; box-shadow: 0 0 15px rgba(212,175,55,0.3); }
    </style>
</head>
<body class="min-h-screen pb-24 antialiased selection:bg-gold selection:text-black overflow-x-hidden">

    <!-- DATA MODEL -->
    <script id="infit-data-model" type="application/json">{"meta":{"nombre":"LEONEL","fechaInicio":"2026-02-17","nivel":2,"lugar":"Commercial Gym","generatedDate":"2026-02-17T20:00:58.883Z"},"contenido":{"frecuencia":"4 Días / Semana","estrategia":"Prioridad a la densidad metabólica y protección articular. Neutral Grip es tu aliado.","promo":"LA DISCIPLINA ES EL PUENTE ENTRE METAS Y LOGROS.","nutricion":"La nutrición adecuada es el 70% - 80 % de tus resultados. \nTambién en INFIT te podemos apoyar con tu plan de alimentación \nCome alimentos reales y evita procesados.","descanso":"Protocolo Biseries \nLimita el descanso entre series a 60-90 segundos.","calentamiento":""},"dias":[{"id":"day-1771357173785-0","label":"Lunes","focus":"Pierna (posterior + Gluteo)","exercises":[{"id":"ex-1771357173785-17fs6","name":"Hip thrust (Barra)                   ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/eecT-JzxxVE"},{"id":"ex-1771357173785-4w8jt","name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"id":"ex-1771357173785-mq3pr","name":"Peso Muerto (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/u304BIfDW3w"},{"id":"ex-1771357173785-ed0yf","name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"id":"ex-1771357173786-04e82","name":"Flexiones (Curl Femoral/Isquios)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/0fqlK8CGmPI"},{"name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"name":"Crunch Abdominal","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/U2Pxw_PLfXc"},{"name":"Planchas","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/3AM7L2k7BEw"}]},{"id":"day-1771357173786-1","label":"Martes","focus":"Pecho + Brazo (biceps) + Hombro","exercises":[{"id":"ex-1771357173786-zmbbi","name":"Press Horizontal (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=g4Ah9uYn8pI"},{"id":"ex-1771357173786-2vx8a","name":"Curl de Bíceps (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/MKWBV29S6c0"},{"id":"ex-1771357173786-et08f","name":"Press Inclinado (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=HboHdKXrYG8"},{"id":"ex-1771357173786-9i22n","name":"Curl Martillo (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/T0txYgZGKWU"},{"id":"ex-1771357173786-j17cq","name":"Press Declinado (Mancuerna)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=MYJfiyYi2q0"},{"name":"Curl 21´s","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/Npgq90WZ4ys"},{"name":"Press Militar (mancuerna)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/MRxd1LA4OYk"},{"name":"Frontales (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/nbNMK8ahVsk"}]},{"id":"day-1771357173786-2","label":"VIERNES","focus":"Pierna (enfoque frontal)","exercises":[{"id":"ex-1771357173786-y2y4x","name":"Extensiones ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/m0iMPJbp03w"},{"id":"ex-1771357173786-wzcja","name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"id":"ex-1771357173786-tjb88","name":"Sentadilla (barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/NHD0vH7XXgw"},{"id":"ex-1771357173786-5n22r","name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"id":"ex-1771357173786-hlnb3","name":"Prensa ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/d-RBtJKPU_g"},{"name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"name":"Elevación de talones ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/FtYFpEC2GYM"},{"name":"Costurera (pantorrilla)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/jeGHLQoKfPk"}]},{"id":"day-1771357173786-3","label":"Sabado","focus":"Espalda + Triceps","exercises":[{"id":"ex-1771357173786-ga2vv","name":"Jalón Abierto (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/RD4t94XvKsU"},{"id":"ex-1771357173786-seta5","name":"Extension con cuerda (Triceps)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/uvrH-ceZg_Q"},{"id":"ex-1771357173786-s90h4","name":"Jalón Cerrado (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/0Mqw-M0BLHE"},{"id":"ex-1771357173786-9vs5i","name":"Extension con barra agarre invertido (triceps)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/_sNTgSwclBs"},{"id":"ex-1771357173786-9i0i2","name":"Remo Sentado (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/iyOM6y5ADAQ"},{"name":"Press Francés (Barra)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/emnTk9VixDA"},{"name":"Encogimientos (en banco)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/RpWYoNsOOEQ"},{"name":"mountain climbers en banco","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/xIp-zSWxwTI"}]}]}</script>

    <!-- LOCK SCREEN (PASSWORD) -->
    <div id="lock-screen">
        <div class="mb-10 text-center relative">
            <div class="absolute inset-0 bg-gold blur-[60px] opacity-10 rounded-full"></div>
            <h1 class="text-6xl font-heading font-bold text-white leading-none brand-logo-client relative z-10">
                IN<span class="text-gold">FIT</span>
            </h1>
            <p class="text-xs text-gray-500 tracking-[0.4em] uppercase font-semibold mt-2">Nivel 2</p>
        </div>
        <p class="text-gray-500 text-[10px] mb-8 uppercase tracking-widest">Contraseña: Nombre + Año</p>
        <input type="password" id="pass-input" class="lock-input mb-8" placeholder="******">
        <button id="unlock-btn" class="px-8 py-3 bg-gold text-black font-heading font-bold uppercase tracking-widest rounded hover:bg-white transition shadow-[0_0_20px_rgba(212,175,55,0.4)]">Acceder</button>
        <p id="error-msg" class="text-red-500 text-xs mt-4 hidden">Contraseña Incorrecta</p>
    </div>

    <!-- LEVEL EXPIRED OVERLAY -->
    <div id="level-expired">
        <i class="fas fa-trophy text-6xl text-gold mb-6 animate-pulse-slow"></i>
        <h2 class="text-3xl font-heading font-bold text-white uppercase italic">¡Nivel Completado!</h2>
        <p class="text-gray-400 text-xs uppercase tracking-widest mt-2 mb-8 max-w-xs">Has completado el ciclo de 30 días del Nivel 2.</p>
        
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm mb-8 border-l-4 border-gold text-left">
            <h3 class="text-white font-bold mb-1">Siguiente: Nivel 3</h3>
            <p class="text-xs text-gray-500">Nueva rutina, mayor intensidad y ajuste nutricional para evitar el estancamiento.</p>
        </div>

        <button onclick="contactForUpgrade()" class="w-full max-w-sm py-4 bg-gradient-to-r from-gold to-yellow-600 rounded-lg text-black font-heading font-bold uppercase tracking-widest text-sm shadow-[0_0_30px_rgba(212,175,55,0.3)] animate-bounce">
            Desbloquear Nivel 3
        </button>
        <button onclick="closeExpired()" class="mt-6 text-gray-600 text-[10px] uppercase hover:text-white">Ver historial (Modo Lectura)</button>
    </div>

    <!-- APP CONTENT -->
    <div id="app-content" class="opacity-0 transition-opacity duration-1000">
        
        <!-- Header Hero Global -->
        <div class="relative h-56 w-full overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center opacity-40"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
            
            <div class="absolute top-6 right-6 flex flex-col items-end">
                 <h1 class="text-xl font-heading font-bold text-white leading-none brand-logo-client opacity-80">
                    IN<span class="text-gold">FIT</span>
                </h1>
                <div class="mt-1 flex gap-2">
                    <div class="px-2 py-0.5 bg-gold text-black text-[9px] font-bold uppercase rounded tracking-wider shadow-lg">
                        Nivel 2
                    </div>
                    <!-- FECHA DE TERMINO -->
                    <div id="end-date-badge" class="px-2 py-0.5 bg-black/50 border border-white/20 text-white text-[9px] font-bold uppercase rounded tracking-wider">
                        <!-- JS Inserted -->
                    </div>
                </div>
            </div>

            <div class="absolute bottom-0 left-0 p-6 w-full">
                <div class="flex items-center gap-2 mb-2">
                    <div id="level-badge-status" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <p id="days-remaining-text" class="text-gray-400 text-[10px] uppercase tracking-widest font-bold">Calculando...</p>
                </div>
                <h1 class="text-3xl font-heading font-bold italic text-white uppercase leading-none">LEONEL</h1>
                
                <!-- Barra de Progreso del Ciclo (30 Días) -->
                <div class="mt-4 w-full bg-gray-800 h-1 rounded-full overflow-hidden">
                    <div id="cycle-progress-bar" class="bg-gold h-full w-0 transition-all duration-1000"></div>
                </div>
            </div>
        </div>

        <main class="px-4 py-6 max-w-md mx-auto">
            
            <!-- VISTA 1: ENTRENAMIENTO -->
            <section id="view-training" class="animate-fade-in">
                <div class="flex overflow-x-auto gap-3 pb-6 scrollbar-hide" id="daySelector"></div>
                <div id="workoutView" class="min-h-[400px]"></div>
            </section>

            <!-- VISTA 2: DIARIO (Modo Carrera) -->
            <section id="view-diary" class="hidden animate-fade-in space-y-6">
                <div class="text-center mb-4">
                     <h2 class="text-2xl font-heading font-bold text-white uppercase italic">Modo Carrera</h2>
                     <p class="text-[10px] text-gray-500 uppercase tracking-widest">Camino al Nivel 3</p>
                </div>
                
                <div class="glass-panel p-5 rounded-xl text-center border-l-4 border-gold relative overflow-hidden">
                    <div class="flex justify-between items-end mb-4 relative z-10">
                        <span class="text-3xl font-heading font-bold text-gold" id="training-progress">0%</span>
                        <span class="text-[10px] text-gray-400 uppercase">Cumplimiento</span>
                    </div>
                    
                    <!-- FRASE MOTIVACIONAL DINAMICA -->
                    <div class="bg-black/40 rounded-lg p-3 border border-white/5 mb-2">
                        <p id="dynamic-motivation" class="text-xs text-gray-200 italic font-medium leading-relaxed">
                            "Cargando motivación..."
                        </p>
                    </div>
                    
                    <p id="cycle-status-text" class="text-[9px] text-gray-500 text-right mt-2">Semana Actual</p>
                </div>

                <div id="training-grid" class="grid grid-cols-5 gap-3"></div>
                
                <div class="text-center mt-8 p-4 border border-dashed border-gray-800 rounded-xl">
                    <p class="text-[9px] text-gray-500 uppercase mb-2">Próximo Hito</p>
                    <button class="text-gray-600 font-heading text-lg uppercase flex items-center justify-center gap-2 w-full cursor-not-allowed opacity-50">
                        <i class="fas fa-lock"></i> Nivel 3
                    </button>
                    <p class="text-[8px] text-gray-600 mt-2">Disponible al completar el ciclo</p>
                </div>
            </section>

            <!-- VISTA 3: PILARES -->
            <section id="view-pillars" class="hidden animate-fade-in space-y-4">
                 <div class="text-center mb-4">
                     <h2 class="text-2xl font-heading font-bold text-white uppercase italic">Filosofía</h2>
                     <p class="text-[10px] text-gray-500 uppercase tracking-widest">Nutrición & Mente</p>
                </div>
                <div class="glass-panel p-5 rounded-2xl border-l-2 border-green-500">
                    <h3 class="font-heading text-lg text-white mb-2 uppercase flex items-center"><i class="fas fa-utensils text-green-500 mr-2 text-sm"></i> Fuel / Nutrición</h3>
                    <p class="text-xs text-gray-400 leading-relaxed whitespace-pre-line">La nutrición adecuada es el 70% - 80 % de tus resultados. 
También en INFIT te podemos apoyar con tu plan de alimentación 
Come alimentos reales y evita procesados.</p>
                </div>
                <div class="glass-panel p-5 rounded-2xl border-l-2 border-blue-500">
                    <h3 class="font-heading text-lg text-white mb-2 uppercase flex items-center"><i class="fas fa-battery-full text-blue-500 mr-2 text-sm"></i> Recovery</h3>
                    <p class="text-xs text-gray-400 leading-relaxed whitespace-pre-line">Protocolo Biseries 
Limita el descanso entre series a 60-90 segundos.</p>
                </div>
            </section>
        </main>
        
        <div class="nav-dock">
            <button onclick="switchView('training')" id="btn-training" class="dock-item active"><i class="fas fa-dumbbell"></i> Entreno</button>
            <button onclick="switchView('diary')" id="btn-diary" class="dock-item"><i class="fas fa-calendar-alt"></i> Diario</button>
            <button onclick="switchView('pillars')" id="btn-pillars" class="dock-item"><i class="fas fa-book-open"></i> Filosofía</button>
        </div>
    </div>

    <script>
        const plan = {"meta":{"nombre":"LEONEL","fechaInicio":"2026-02-17","nivel":2,"lugar":"Commercial Gym","generatedDate":"2026-02-17T20:00:58.883Z"},"contenido":{"frecuencia":"4 Días / Semana","estrategia":"Prioridad a la densidad metabólica y protección articular. Neutral Grip es tu aliado.","promo":"LA DISCIPLINA ES EL PUENTE ENTRE METAS Y LOGROS.","nutricion":"La nutrición adecuada es el 70% - 80 % de tus resultados. \nTambién en INFIT te podemos apoyar con tu plan de alimentación \nCome alimentos reales y evita procesados.","descanso":"Protocolo Biseries \nLimita el descanso entre series a 60-90 segundos.","calentamiento":""},"dias":[{"id":"day-1771357173785-0","label":"Lunes","focus":"Pierna (posterior + Gluteo)","exercises":[{"id":"ex-1771357173785-17fs6","name":"Hip thrust (Barra)                   ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/eecT-JzxxVE"},{"id":"ex-1771357173785-4w8jt","name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"id":"ex-1771357173785-mq3pr","name":"Peso Muerto (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/u304BIfDW3w"},{"id":"ex-1771357173785-ed0yf","name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"id":"ex-1771357173786-04e82","name":"Flexiones (Curl Femoral/Isquios)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/0fqlK8CGmPI"},{"name":"Sentadilla bulgara","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/vNoLabSf5Mk"},{"name":"Crunch Abdominal","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/U2Pxw_PLfXc"},{"name":"Planchas","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/3AM7L2k7BEw"}]},{"id":"day-1771357173786-1","label":"Martes","focus":"Pecho + Brazo (biceps) + Hombro","exercises":[{"id":"ex-1771357173786-zmbbi","name":"Press Horizontal (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=g4Ah9uYn8pI"},{"id":"ex-1771357173786-2vx8a","name":"Curl de Bíceps (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/MKWBV29S6c0"},{"id":"ex-1771357173786-et08f","name":"Press Inclinado (Barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=HboHdKXrYG8"},{"id":"ex-1771357173786-9i22n","name":"Curl Martillo (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/T0txYgZGKWU"},{"id":"ex-1771357173786-j17cq","name":"Press Declinado (Mancuerna)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/watch?v=MYJfiyYi2q0"},{"name":"Curl 21´s","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/Npgq90WZ4ys"},{"name":"Press Militar (mancuerna)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/MRxd1LA4OYk"},{"name":"Frontales (Mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/nbNMK8ahVsk"}]},{"id":"day-1771357173786-2","label":"VIERNES","focus":"Pierna (enfoque frontal)","exercises":[{"id":"ex-1771357173786-y2y4x","name":"Extensiones ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/m0iMPJbp03w"},{"id":"ex-1771357173786-wzcja","name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"id":"ex-1771357173786-tjb88","name":"Sentadilla (barra)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/NHD0vH7XXgw"},{"id":"ex-1771357173786-5n22r","name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"id":"ex-1771357173786-hlnb3","name":"Prensa ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/d-RBtJKPU_g"},{"name":"Sentadilla goblet (mancuerna)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/lRYBbchqxtI"},{"name":"Elevación de talones ","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/FtYFpEC2GYM"},{"name":"Costurera (pantorrilla)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/jeGHLQoKfPk"}]},{"id":"day-1771357173786-3","label":"Sabado","focus":"Espalda + Triceps","exercises":[{"id":"ex-1771357173786-ga2vv","name":"Jalón Abierto (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/RD4t94XvKsU"},{"id":"ex-1771357173786-seta5","name":"Extension con cuerda (Triceps)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/uvrH-ceZg_Q"},{"id":"ex-1771357173786-s90h4","name":"Jalón Cerrado (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/0Mqw-M0BLHE"},{"id":"ex-1771357173786-9vs5i","name":"Extension con barra agarre invertido (triceps)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/_sNTgSwclBs"},{"id":"ex-1771357173786-9i0i2","name":"Remo Sentado (Polea)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/iyOM6y5ADAQ"},{"name":"Press Francés (Barra)","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/emnTk9VixDA"},{"name":"Encogimientos (en banco)","sets":"4","reps":"10 ⬇️","url":"https://www.youtube.com/shorts/RpWYoNsOOEQ"},{"name":"mountain climbers en banco","sets":"4","reps":"10 ⬆️","url":"https://www.youtube.com/shorts/xIp-zSWxwTI"}]}]};
        let activeDayIdx = 0;
        
        // --- LOGICA DE FECHAS Y NIVELES ---
        const startDate = new Date(plan.meta.fechaInicio);
        // Calcular fecha de fin (Inicio + 29 días = 30 días total)
        const endDate = new Date(startDate);
        endDate.setDate(startDate.getDate() + 29);
        
        const today = new Date();
        const diffTime = Math.abs(today - startDate);
        const dayOfCycle = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
        const isExpired = dayOfCycle > 30;
        
        // Firebase Auth
        const firebaseConfig = {
            apiKey: "AIzaSyAv1BfTCiQWgPXvtpMW14RdhbLyY4yGtiY",
            authDomain: "infit-reto.firebaseapp.com",
            databaseURL: "https://infit-reto-default-rtdb.firebaseio.com",
            projectId: "infit-reto",
            storageBucket: "infit-reto.firebasestorage.app",
            messagingSenderId: "881118508637",
            appId: "1:881118508637:web:26d5487e848aa4cd2d7fb4"
        };
        let db;
        let userId; 
        let trainingData = Array(30).fill(false);

        // --- INICIALIZACIÓN ---
        document.getElementById('unlock-btn').addEventListener('click', checkPass);
        document.getElementById('pass-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkPass() });

        function checkPass() {
            const firstName = plan.meta.nombre.trim().split(" ")[0].toUpperCase();
            const correctPass = firstName + new Date().getFullYear();
            const input = document.getElementById('pass-input').value.toUpperCase().trim();
            
            if (input === correctPass || input === "MASTERKEY") {
                const lock = document.getElementById('lock-screen');
                const content = document.getElementById('app-content');
                userId = plan.meta.nombre.toLowerCase().replace(/[^a-z0-9]/g, '');
                
                initFirebase();
                updateLevelUI();
                setDynamicMotivation(); // Nueva función motivacional

                lock.style.opacity = '0';
                setTimeout(() => {
                    lock.style.display = 'none';
                    content.classList.remove('opacity-0');
                    if(isExpired) showExpiredModal();
                }, 500);
            } else {
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        // --- UI DE NIVELES ---
        function updateLevelUI() {
            const remaining = 30 - dayOfCycle;
            const bar = document.getElementById('cycle-progress-bar');
            const statusText = document.getElementById('days-remaining-text');
            const diaryText = document.getElementById('cycle-status-text');
            const badge = document.getElementById('level-badge-status');
            
            // Mostrar fecha de termino formateada (DD/MM)
            const options = { day: 'numeric', month: 'short' };
            const dateStr = endDate.toLocaleDateString('es-ES', options).toUpperCase().replace('.', '');
            document.getElementById('end-date-badge').innerText = `TERMINA: ${dateStr}`;

            let cyclePercent = (dayOfCycle / 30) * 100;
            if(cyclePercent > 100) cyclePercent = 100;
            bar.style.width = `${cyclePercent}%`;

            if (isExpired) {
                statusText.innerText = "CICLO COMPLETADO";
                statusText.classList.add('text-gold');
                diaryText.innerText = "Ciclo finalizado.";
                badge.className = "w-2 h-2 rounded-full bg-gold animate-pulse";
            } else if (remaining < 0) {
                 statusText.innerText = "ESPERANDO INICIO";
                 bar.style.width = "0%";
            } else {
                statusText.innerText = `DÍA ${dayOfCycle} DE 30`;
                diaryText.innerText = `Estás en el día ${dayOfCycle} del ciclo.`;
                badge.className = "w-2 h-2 rounded-full bg-green-500 animate-pulse";
            }
        }
        
        // --- NUEVA LÓGICA DE MOTIVACIÓN ---
        function setDynamicMotivation() {
            const msgEl = document.getElementById('dynamic-motivation');
            let week = 1;
            if (dayOfCycle > 7 && dayOfCycle <= 14) week = 2;
            if (dayOfCycle > 14 && dayOfCycle <= 21) week = 3;
            if (dayOfCycle > 21) week = 4;
            
            const messages = {
                1: [ // Semana 1: Arranque
                    "El primer paso siempre es el más difícil. Estás construyendo Tu Mejor Versión.",
                    "No te preocupes por la perfección, enfócate en comenzar.",
                    "Esta semana define el tono del resto del mes. ¡Vamos con todo!"
                ],
                2: [ // Semana 2: Constancia
                    "La motivación te inicia, el hábito te mantiene.",
                    "Ya pasaste lo más difícil. Ahora toca ser constante.",
                    "Tu Mejor Versión se construye repetición a repetición."
                ],
                3: [ // Semana 3: Disciplina
                    "Aquí es donde la mayoría renuncia. Tú eres diferente.",
                    "El Nivel 3 está cada vez más cerca.",
                    "Convierte el dolor del esfuerzo en orgullo."
                ],
                4: [ // Semana 4: Cierre / Venta
                    "¡Recta final! Cierra fuerte para desbloquear el siguiente nivel.",
                    "Estás a nada de evolucionar. No te detengas ahora.",
                    "Tu cuerpo ya pide el siguiente desafío. Termina este ciclo con honor."
                ]
            };
            
            // Selección aleatoria dentro de la semana correspondiente
            const weekMsgs = messages[week] || messages[4];
            const randomMsg = weekMsgs[Math.floor(Math.random() * weekMsgs.length)];
            msgEl.innerText = randomMsg;
        }

        function showExpiredModal() {
            document.getElementById('level-expired').style.display = 'flex';
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#D4AF37', '#FFFFFF'] });
        }

        function closeExpired() {
            document.getElementById('level-expired').style.display = 'none';
        }

        function contactForUpgrade() {
            Swal.fire({
                title: 'Solicitar Siguiente Nivel',
                text: 'Serás redirigido para activar tu plan Nivel ' + (plan.meta.nivel + 1),
                icon: 'info',
                confirmButtonText: 'CONTACTAR ENTRENADOR',
                confirmButtonColor: '#D4AF37',
                background: '#111',
                color: '#fff'
            });
        }

        // --- FIREBASE & DIARY ---
        function initFirebase() {
            try {
                if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                loadData();
            } catch (e) { console.error("Firebase Error:", e); }
        }

        function loadData() {
            if (db && userId) {
                db.ref('training/' + userId + '/level_' + plan.meta.nivel).once('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data && data.progress) trainingData = data.progress;
                    renderGrid();
                    updateStats();
                });
            }
        }

        function renderGrid() {
            const grid = document.getElementById('training-grid');
            grid.innerHTML = '';
            
            for(let i=0; i<30; i++) {
                const completed = trainingData[i];
                const isToday = (i + 1) === dayOfCycle;

                const dayDiv = document.createElement('div');
                let classes = "day-check h-14 rounded-xl flex flex-col items-center justify-center border border-gray-800 bg-black/40 relative select-none";
                
                if (isToday) classes += " today-border";

                if (completed) {
                    classes += " completed";
                    dayDiv.innerHTML = `<i class="fas fa-check text-xl"></i>`;
                } else {
                    dayDiv.innerHTML = `
                        <span class="text-[8px] text-gray-500 font-bold uppercase tracking-wider">DÍA</span>
                        <span class="text-white font-heading text-lg font-bold">${i+1}</span>
                    `;
                }
                dayDiv.className = classes;
                dayDiv.onclick = () => toggleDay(i);
                grid.appendChild(dayDiv);
            }
        }

        function toggleDay(index) {
            const wasCompleted = trainingData[index];
            trainingData[index] = !wasCompleted;

            if (!wasCompleted) {
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.7 }, colors: ['#D4AF37'] });
            }
            saveData();
            renderGrid();
            updateStats();
        }

        function saveData() {
            if (db && userId) {
                db.ref('training/' + userId + '/level_' + plan.meta.nivel).set({
                    progress: trainingData,
                    lastUpdate: new Date().toISOString()
                });
            }
        }

        function updateStats() {
            const completedCount = trainingData.filter(Boolean).length;
            const percentage = Math.round((completedCount / 30) * 100);
            document.getElementById('training-progress').textContent = `${percentage}%`;
        }

        // --- RENDERIZADO BASICO (WORKOUT) ---
        function switchView(viewName) {
            ['training', 'diary', 'pillars'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                document.getElementById(`btn-${v}`).classList.remove('active');
            });
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            document.getElementById(`btn-${viewName}`).classList.add('active');
        }

        function renderSelector() {
            const container = document.getElementById('daySelector');
            container.innerHTML = plan.dias.map((d, i) => `
                <button onclick="setDay(${i})" class="flex-shrink-0 w-16 h-16 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 ${i === activeDayIdx ? 'bg-gold text-black shadow-lg shadow-yellow-500/20 scale-105' : 'bg-white/5 text-gray-500 border border-white/5'}">
                    <span class="text-[10px] font-bold uppercase">${d.label.substring(0,3)}</span>
                    <span class="text-lg font-heading font-bold">${i + 1}</span>
                </button>
            `).join('');
        }

        function renderWorkout() {
            const day = plan.dias[activeDayIdx];
            const container = document.getElementById('workoutView');
            let html = `
                <div class="animate-fade-in pb-10">
                    <div class="mb-6 flex justify-between items-baseline">
                        <h2 class="text-2xl font-heading italic font-bold text-white uppercase gold-text">${day.focus}</h2>
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest">${day.exercises.length} MOVIMIENTOS</span>
                    </div>

                    <!-- ACTIVACIÓN / WARM UP (FIJO) -->
                    <div class="bg-gradient-to-r from-yellow-900/20 to-transparent border-l-2 border-gold p-4 rounded-r-xl mb-6">
                        <h3 class="text-gold font-heading text-sm uppercase mb-1 flex items-center"><i class="fas fa-fire-alt mr-2"></i> Activación</h3>
                        <p class="text-[10px] text-gray-400 leading-relaxed">Inicia con 5-10 min de cardio ligero + 2 series de aproximación del primer ejercicio.</p>
                    </div>

                    <div class="space-y-3">
            `;
            day.exercises.forEach((ex, idx) => {
                html += `
                    <div class="card-exercise p-4 rounded-xl flex items-center justify-between group">
                        <div class="flex items-center gap-4 flex-1">
                            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-sm font-heading font-bold text-gold">${idx + 1}</div>
                            <div>
                                <h3 class="font-bold text-white text-sm uppercase">${ex.name}</h3>
                                <div class="flex gap-3 mt-1.5">
                                    <div class="flex items-center text-[10px] text-gray-400 bg-black/50 px-2 py-0.5 rounded border border-white/5">
                                        <i class="fas fa-layer-group text-gold mr-1.5"></i> ${ex.sets}
                                    </div>
                                    <div class="flex items-center text-[10px] text-gray-400 bg-black/50 px-2 py-0.5 rounded border border-white/5">
                                        <i class="fas fa-dumbbell text-gold mr-1.5"></i> ${ex.reps}
                                    </div>
                                </div>
                            </div>
                        </div>
                        ${ex.url ? `<a href="${ex.url}" target="_blank" class="w-10 h-10 rounded-full bg-gold flex items-center justify-center text-black shadow-lg shadow-yellow-500/20 active:scale-90 transition-transform"><i class="fas fa-play text-xs ml-0.5"></i></a>` : ''}
                    </div>
                `;
            });
            
            // ENFRIAMIENTO (FIJO)
            html += `</div>
                    <div class="bg-gradient-to-r from-blue-900/20 to-transparent border-l-2 border-blue-500 p-4 rounded-r-xl mt-6">
                        <h3 class="text-blue-400 font-heading text-sm uppercase mb-1 flex items-center"><i class="fas fa-snowflake mr-2"></i> Enfriamiento</h3>
                        <p class="text-[10px] text-gray-400 leading-relaxed">Finaliza con 5-10 min de estiramientos estáticos para acelerar la recuperación.</p>
                    </div>
            </div>`;
            container.innerHTML = html;
        }

        function setDay(idx) { activeDayIdx = idx; renderSelector(); renderWorkout(); }
        window.onload = () => { renderSelector(); renderWorkout(); }
    </script>
</body>
</html>
